<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Прогноз сроков задач — Revoks</title>
    <meta name="color-scheme" content="light" />
    <meta name="yandex-verification" content="abf314e9a2a2131d" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="header-inner">
        <div class="title-wrap">
          <h1>Прогноз сроков задач</h1>
          <button id="pageInfoBtn" class="icon-btn" title="О странице" aria-label="О странице">
            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m1 15h-2v-6h2Zm0-8h-2V7h2Z"/></svg>
          </button>
          <span class="badge beta" title="Прототип для решенческого интервью">beta</span>
        </div>
        <div class="controls">
          <div class="search-wrap">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5l1.5-1.5l-5-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14z"/></svg>
            <input id="searchInput" type="search" placeholder="Поиск по ключу или названию…" />
          </div>
          <label class="filter">
            <span>Риск</span>
            <select id="riskFilter">
              <option value="all" selected>Все</option>
              <option value="high">Высокий</option>
              <option value="medium">Средний</option>
              <option value="low">Низкий</option>
            </select>
          </label>
          <label class="filter">
            <span>Отображение</span>
            <select id="viewMode">
              <option value="days" selected>В днях</option>
              <option value="dates">Датами</option>
            </select>
          </label>
          <div class="spacer"></div>
          <button id="resetDataBtn" class="btn btn-ghost" title="Сбросить к демонстрационным данным">Сброс</button>
          <button id="demoToggleBtn" class="btn btn-ghost" title="Открыть демо-подсказки">Демо</button>
          <button id="addTaskBtn" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"/></svg>
            Добавить задачу
          </button>
        </div>
        <div class="meta-bar" id="metaBar">
          <span id="metaSource">
            Источник прогноза: Jira (демо)
            <button id="sourceInfoBtn" class="icon-btn" title="Подробнее об источнике" aria-label="Подробнее об источнике">
              <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m1 15h-2v-6h2Zm0-8h-2V7h2Z"/></svg>
            </button>
          </span>
          <span class="dot">•</span>
          <span id="metaUpdated">Данные обновлены: —</span>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="table-wrap">
        <table id="tasksTable" class="tasks-table">
          <thead>
            <tr>
              <th data-key="key" class="sortable">Задача</th>
              <th data-key="estimateDays" class="sortable num">Оценка, дн</th>
              <th data-key="forecastDays" class="sortable num" id="forecastColHeader">
                <span id="forecastColHeaderText">Прогноз (ИИ)</span>
                <button id="forecastInfoBtn" class="icon-btn" title="Как считается прогноз" aria-label="Как считается прогноз">
                  <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m1 15h-2v-6h2Zm0-8h-2V7h2Z"/></svg>
                </button>
              </th>
              <th data-key="delta" class="sortable num">Δ</th>
              <th data-key="risk" class="sortable">Риск</th>
            </tr>
          </thead>
          <tbody id="tasksTbody"></tbody>
        </table>
        <div id="emptyState" class="empty hidden">
          Нет задач. Нажмите «Добавить задачу», чтобы начать.
        </div>
      </div>
      <p class="note">
        Прогноз рассчитывается ИИ на основе истории выполнения похожих задач.
      </p>
    </main>

    <!-- Модалка добавления задачи -->
    <dialog id="addTaskDialog" class="modal">
      <form method="dialog" id="addTaskForm" class="modal-card">
        <header class="modal-header">
          <h2>Добавить задачу</h2>
        </header>
        <section class="modal-body">
          <div class="grid">
            <label class="field">
              <span>Ключ задачи</span>
              <input name="key" type="text" required placeholder="напр. MORT-123" />
            </label>
            <label class="field">
              <span>Название</span>
              <input name="title" type="text" required placeholder="кратко о задаче" />
            </label>
            <label class="field">
              <span>Этап</span>
              <select name="stage">
                <option value="backlog">До разработки</option>
                <option value="in_progress" selected>В разработке</option>
                <option value="ready_for_test">Готово к тесту</option>
                <option value="testing">В тестировании</option>
                <option value="awaiting_acceptance">Ожидает приёмки</option>
                <option value="done">Done</option>
              </select>
            </label>
            <label class="field">
              <span>Тип</span>
              <select name="type">
                <option value="feature" selected>Фича</option>
                <option value="task">Задача</option>
                <option value="bug">Баг</option>
                <option value="improvement">Улучшение</option>
                <option value="spike">Исследование</option>
                <option value="doc">Документация</option>
                <option value="epic">Эпик</option>
                <option value="bt">Бизнес‑требование (БТ)</option>
                <option value="ft">Функциональное требование (ФТ)</option>
              </select>
            </label>
            <label class="field">
              <span>Оценка (дни)</span>
              <input name="estimate" type="number" min="1" step="1" required placeholder="напр. 5" />
            </label>
            <label class="field">
              <span>Ссылка (необязательно)</span>
              <input name="url" type="url" placeholder="https://…" />
            </label>
          </div>

          <details class="details">
            <summary>Дополнительно (факторы и структура)</summary>
            <div class="grid grid-compact">
              <label class="field">
                <span>Сложность</span>
                <select name="complexity">
                  <option value="low">Низкая</option>
                  <option value="medium" selected>Средняя</option>
                  <option value="high">Высокая</option>
                </select>
              </label>
              <label class="field">
                <span>Зависимости</span>
                <select name="deps">
                  <option value="low">Мало</option>
                  <option value="medium" selected>Средне</option>
                  <option value="high">Много</option>
                </select>
              </label>
              <label class="field">
                <span>Новизна</span>
                <select name="novelty">
                  <option value="low">Низкая</option>
                  <option value="medium" selected>Средняя</option>
                  <option value="high">Высокая</option>
                </select>
              </label>
            </div>
            <div class="checks">
              <label><input type="checkbox" name="external_api" /> Внешний API</label>
              <label><input type="checkbox" name="integration" /> Интеграция</label>
              <label><input type="checkbox" name="regulatory" /> Регуляторика</label>
              <label><input type="checkbox" name="mobile" /> Мобильное</label>
              <label><input type="checkbox" name="web" /> Веб</label>
            </div>
            <div class="grid" style="margin-top: 8px;">
              <label class="field">
                <span>БТ (бизнес-требование)</span>
                <input name="bt" type="text" placeholder="напр. БТ-12" />
              </label>
              <label class="field">
                <span>ФТ (функциональное требование)</span>
                <input name="ft" type="text" placeholder="напр. ФТ-3" />
              </label>
            </div>
          </details>
        </section>
        <footer class="modal-footer">
          <button value="cancel" class="btn btn-ghost">Отмена</button>
          <button value="submit" class="btn btn-primary">Добавить</button>
        </footer>
      </form>
    </dialog>

    <!-- Контейнер для всплывающих пояснений прогноза -->
    <div id="explainPopover" class="popover hidden" role="dialog" aria-modal="false"></div>

    <!-- Лёгкая панель подсказок для демонстрации (интервью AJTBD) -->
    <aside id="demoPanel" class="demo-panel hidden" aria-live="polite">
      <header class="demo-header">
        <strong>Сценарий демо</strong>
        <button id="demoCloseBtn" class="icon-btn" title="Скрыть подсказки" aria-label="Скрыть подсказки">
          <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"/></svg>
        </button>
      </header>
      <ol class="demo-steps">
        <li>Найдите задачу с высоким риском и откройте «Пояснение».</li>
        <li>Включите «Датами» и обсудите две даты: «Разработка» и «Поставка».</li>
        <li>Добавьте их задачу и сравните оценку vs прогноз.</li>
      </ol>
      <div class="demo-foot">Фокус: назвать реалистичную дату и объяснить почему.</div>
    </aside>

    <script src="app.js"></script>
  </body>
  </html>
